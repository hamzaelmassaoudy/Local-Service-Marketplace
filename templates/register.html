{% extends 'base.html' %}

{% block title %}Join | LocalPro{% endblock %}

{% block content %}
<div class="min-h-[calc(100vh-80px)] flex items-center justify-center bg-slate-50">
    <div class="bg-white w-full max-w-md p-8 rounded-2xl shadow-lg border border-gray-100">
        <h1 class="text-3xl font-extrabold text-slate-900 mb-2 text-center">Join LocalPro</h1>
        <p class="text-slate-500 text-center mb-8">Hire pros or sell your services.</p>
        
        <form onsubmit="handleRegister(event)" class="space-y-4">
            <div>
                <label class="block text-sm font-bold text-slate-700 mb-1">Username</label>
                <input id="username" type="text" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand focus:border-brand outline-none transition" required>
            </div>
            <div>
                <label class="block text-sm font-bold text-slate-700 mb-1">Email</label>
                <input id="email" type="email" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand focus:border-brand outline-none transition" required>
            </div>
            <div>
                <label class="block text-sm font-bold text-slate-700 mb-1">Password</label>
                <input id="password" type="password" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand focus:border-brand outline-none transition" required>
            </div>
            <button class="w-full bg-slate-900 hover:bg-slate-800 text-white font-bold py-3.5 rounded-xl transition shadow-lg">Create Account</button>
        </form>

        <p class="text-center mt-6 text-slate-500">
            Already a member? <a href="/login/" class="text-brand font-bold hover:underline">Sign In</a>
        </p>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    // --- API CONFIG ---
    const API_URL = 'http://127.0.0.1:8000/api/v1';

    const API = {
        fetch: async (endpoint, method='GET', body=null) => {
            const opts = { method, headers: { 'Content-Type': 'application/json' } };
            if(body) opts.body = JSON.stringify(body);
            try {
                const res = await fetch(API_URL + endpoint, opts);
                // Handle different response types (some might not return JSON on error)
                if (!res.ok) {
                    alert("Registration failed. Please try a different username/email.");
                    return null;
                }
                return await res.json();
            } catch(e) { console.error(e); return null; }
        }
    };

    // --- REGISTER LOGIC ---
    async function handleRegister(e) {
        e.preventDefault();
        const username = document.getElementById('username').value;
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        
        const res = await API.fetch('/auth/register/', 'POST', { username, email, password });
        
        if(res && res.user) {
            alert("Account Created Successfully! Please login.");
            window.location.href = '/login/';
        }
    }
</script>
{% endblock %}